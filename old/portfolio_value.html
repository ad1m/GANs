<!DOCTYPE html>
<html >
<head>
  <meta charset="UTF-8">
  <title>Portfolio Construction</title>
  
  
  <link rel='stylesheet prefetch' href='https://fonts.googleapis.com/css?family=Inconsolata|Space+Mono:700'>
<link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css'>
<link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css'>

      <link rel="stylesheet" href="css/style.css">

      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89638118-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body>
  <main>
  <style>
  a {
  	color: brown
  }
  .shorter {
    width: 450px;
  }
  </style>
  <div class="preview__link" href="#" itemprop="url">
              <span class="preview__date" itemprop="datePublished" datetime="2016-09-07T00:00:00-07:00">Jan 05, 2017</span>
              <center><h2 class="preview__header" itemprop="name">Portfolio Construction</h2></center>
              <center><u><h4>What Will We Learn?</h4></u></center>
              <p>A portfolio consists of a set of stocks each with a specific number of shares. Every day the value of the portfolio changes and our total portfolio value fluctuates. In this lesson, we will learn how to construct a portfolio in python and plot its performance over time. Additionally, we will learn how to plot each stock in the portfolio so that we can visualize which stocks are top performers. </p>
              <center><u><h4>Libraries We Need</h4></u></center>
              <p>We need the following libraries for our program:
              <ol>
              <li>pandas: We will use the pandas dataframe to hold our adjusted close prices and a pandas series to hold our portfolio value. To install pandas go to your terminal or command prompt and use pip install pandas to download the pandas package on your machine. If you installed tha anaconda distribution then you have pandas installed.</li>
              <li>panda_datareader: We will use this to scrape our adjusted close prices into a dictionary, which we will then turn into a dataframe. To download this library go to your terminal or command prompt and type in pip install pandas-datareader. If you installed the anaconda distribution then you have this library on your machine.</li>
              <li>matplotlib: We will use matplotlib to plot our portfolio value over time as well as the stocks in our portfolio. To install matplotlib go to your terminal or command prompt and type pip install matplotlib. If you installed the anaconda distribution then you have matplotlib on your machine.</li>
              </ol>
              </p>
              <center><u><h4>What Our Program Will Do</h4></u></center>
              <p>We will write four functions. Our first function will be a variation of the historical data scraping function we wrote in the tutorial <a href='scraping_historical_data.html'>here</a>. Instead of saving all of the yahoo finance data to a csv file we will hold it in a pandas dataframe. Our second function will calculate the portfolio value over our time period. We will then create a function to plot the portfolio value and save a png image of it. We will then write our fourth and final function which will plot and save the line chart for each of our stocks on one graph.</p>

              <center><u><h4>Implementation</h4></u></center>
              <p>Let us create a python file called Portfolio_Construction.py and import the following packages: pandas, pandas_datareader.data, and matplotlib.pyplot. We do so as follows:</p>
              <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">pd</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas_datareader.data</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">web</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">plt</span>
</pre></div>



              <p>Next, we create our function which obtains the adjusted close prices and holds them in a pandas dataframe. We will call this function get_adjusted_close and this will take in a list of tickers, a start data, and an end date. We will use the web.DataReader just like we did in the Scraping Historical Data tutorial and store the scraped yahoo finance data in a dictionary. We will then put all of our data in a panel and use a pandas function pan.minor_xs to create a dataframe that holds only the adjusted close prices for each stock in our portfolio. We do so as follows:</p>
              <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">pd</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas_datareader.data</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">web</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">plt</span>

<span style="color: #0000aa">def</span> <span style="color: #00aa00">get_adjusted_close</span>(tickers,start,end):
    d = {} 
    <span style="color: #0000aa">for</span> ticker <span style="color: #0000aa">in</span> tickers:
        d[ticker] = web.DataReader(ticker,<span style="color: #aa5500">&quot;yahoo&quot;</span>,start,end) 
    pan = pd.Panel(d)
    df_adj_close = pan.minor_xs(<span style="color: #aa5500">&#39;Adj Close&#39;</span>)
    <span style="color: #0000aa">return</span> df_adj_close
</pre></div>



              <p>We can run the above function as follows:</p>
              <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">pd</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas_datareader.data</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">web</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">plt</span>

<span style="color: #0000aa">def</span> <span style="color: #00aa00">get_adjusted_close</span>(tickers,start,end):
    d = {} 
    <span style="color: #0000aa">for</span> ticker <span style="color: #0000aa">in</span> tickers:
        d[ticker] = web.DataReader(ticker,<span style="color: #aa5500">&quot;yahoo&quot;</span>,start,end) 
    pan = pd.Panel(d)
    df_adj_close = pan.minor_xs(<span style="color: #aa5500">&#39;Adj Close&#39;</span>)
    <span style="color: #0000aa">return</span> df_adj_close

<span style="color: #0000aa">if</span> __name__ == <span style="color: #aa5500">&#39;__main__&#39;</span>:
    tickers = [<span style="color: #aa5500">&#39;AAPL&#39;</span>,<span style="color: #aa5500">&#39;BAC&#39;</span>,<span style="color: #aa5500">&#39;GILD&#39;</span>,<span style="color: #aa5500">&#39;MSFT&#39;</span>]
    start = <span style="color: #aa5500">&#39;2014-01-01&#39;</span>
    end = <span style="color: #aa5500">&#39;2016-12-21&#39;</span>
    df_adj_close = get_adjusted_close(tickers,start,end)
    <span style="color: #0000aa">print</span> df_adj_close
</pre></div>



              <p>Our output for the sample query is as follows:</p>
              <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">                  AAPL        BAC       GILD       MSFT
Date                                                   
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">02</span>   <span style="color: #009999">74.437252</span>  <span style="color: #009999">15.547610</span>  <span style="color: #009999">72.642707</span>  <span style="color: #009999">34.270616</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">03</span>   <span style="color: #009999">72.802175</span>  <span style="color: #009999">15.846973</span>  <span style="color: #009999">71.783088</span>  <span style="color: #009999">34.040055</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">06</span>   <span style="color: #009999">73.199166</span>  <span style="color: #009999">16.088396</span>  <span style="color: #009999">70.739952</span>  <span style="color: #009999">33.320705</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">07</span>   <span style="color: #009999">72.675675</span>  <span style="color: #009999">15.933885</span>  <span style="color: #009999">70.295655</span>  <span style="color: #009999">33.578933</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">08</span>   <span style="color: #009999">73.135920</span>  <span style="color: #009999">16.011140</span>  <span style="color: #009999">70.952443</span>  <span style="color: #009999">32.979472</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">09</span>   <span style="color: #009999">72.201969</span>  <span style="color: #009999">16.252563</span>  <span style="color: #009999">71.763774</span>  <span style="color: #009999">32.767356</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">10</span>   <span style="color: #009999">71.720191</span>  <span style="color: #009999">16.194622</span>  <span style="color: #009999">72.314316</span>  <span style="color: #009999">33.237703</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">13</span>   <span style="color: #009999">72.095658</span>  <span style="color: #009999">15.866287</span>  <span style="color: #009999">70.643367</span>  <span style="color: #009999">32.260122</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">14</span>   <span style="color: #009999">73.530224</span>  <span style="color: #009999">16.194622</span>  <span style="color: #009999">72.430215</span>  <span style="color: #009999">32.997917</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">15</span>   <span style="color: #009999">75.006503</span>  <span style="color: #009999">16.561583</span>  <span style="color: #009999">72.662028</span>  <span style="color: #009999">33.901717</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">16</span>   <span style="color: #009999">74.587979</span>  <span style="color: #009999">16.493985</span>  <span style="color: #009999">75.240886</span>  <span style="color: #009999">34.021610</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">17</span>   <span style="color: #009999">72.760454</span>  <span style="color: #009999">16.426387</span>  <span style="color: #009999">75.723819</span>  <span style="color: #009999">33.551266</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">21</span>   <span style="color: #009999">73.890878</span>  <span style="color: #009999">16.426387</span>  <span style="color: #009999">78.795270</span>  <span style="color: #009999">33.357592</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">22</span>   <span style="color: #009999">74.219240</span>  <span style="color: #009999">16.561583</span>  <span style="color: #009999">79.374787</span>  <span style="color: #009999">33.136255</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">23</span>   <span style="color: #009999">74.847705</span>  <span style="color: #009999">16.281534</span>  <span style="color: #009999">79.345813</span>  <span style="color: #009999">33.256148</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">24</span>   <span style="color: #009999">73.487159</span>  <span style="color: #009999">15.885602</span>  <span style="color: #009999">77.868040</span>  <span style="color: #009999">33.947832</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">27</span>   <span style="color: #009999">74.083325</span>  <span style="color: #009999">15.750404</span>  <span style="color: #009999">76.168116</span>  <span style="color: #009999">33.228479</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">28</span>   <span style="color: #009999">68.162036</span>  <span style="color: #009999">16.155994</span>  <span style="color: #009999">77.916329</span>  <span style="color: #009999">33.449819</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">29</span>   <span style="color: #009999">67.388235</span>  <span style="color: #009999">16.107710</span>  <span style="color: #009999">77.124320</span>  <span style="color: #009999">33.809494</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">30</span>   <span style="color: #009999">67.257696</span>  <span style="color: #009999">16.349132</span>  <span style="color: #009999">78.737313</span>  <span style="color: #009999">33.993943</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">31</span>   <span style="color: #009999">67.368046</span>  <span style="color: #009999">16.175308</span>  <span style="color: #009999">77.897015</span>  <span style="color: #009999">34.897743</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">03</span>   <span style="color: #009999">67.493202</span>  <span style="color: #009999">15.789032</span>  <span style="color: #009999">76.139141</span>  <span style="color: #009999">33.643489</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">04</span>   <span style="color: #009999">68.470218</span>  <span style="color: #009999">15.789032</span>  <span style="color: #009999">79.220245</span>  <span style="color: #009999">33.523597</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">05</span>   <span style="color: #009999">68.981598</span>  <span style="color: #009999">15.837316</span>  <span style="color: #009999">75.482352</span>  <span style="color: #009999">33.034808</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">06</span>   <span style="color: #009999">69.383675</span>  <span style="color: #009999">16.117367</span>  <span style="color: #009999">73.888674</span>  <span style="color: #009999">33.366817</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">07</span>   <span style="color: #009999">70.354349</span>  <span style="color: #009999">16.242906</span>  <span style="color: #009999">76.061870</span>  <span style="color: #009999">33.717271</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">10</span>   <span style="color: #009999">71.614740</span>  <span style="color: #009999">16.146336</span>  <span style="color: #009999">78.215752</span>  <span style="color: #009999">33.938607</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">11</span>   <span style="color: #009999">72.558338</span>  <span style="color: #009999">16.300847</span>  <span style="color: #009999">79.007761</span>  <span style="color: #009999">34.279837</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">12</span>   <span style="color: #009999">72.552923</span>  <span style="color: #009999">16.175308</span>  <span style="color: #009999">79.200931</span>  <span style="color: #009999">34.556513</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">13</span>   <span style="color: #009999">73.705007</span>  <span style="color: #009999">16.175308</span>  <span style="color: #009999">79.732160</span>  <span style="color: #009999">34.685627</span>
...                ...        ...        ...        ...
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">09</span>  <span style="color: #009999">110.879997</span>  <span style="color: #009999">17.903575</span>  <span style="color: #009999">77.968014</span>  <span style="color: #009999">59.766244</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">10</span>  <span style="color: #009999">107.790001</span>  <span style="color: #009999">18.690656</span>  <span style="color: #009999">77.342039</span>  <span style="color: #009999">58.306110</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">11</span>  <span style="color: #009999">108.430000</span>  <span style="color: #009999">18.949695</span>  <span style="color: #009999">75.931125</span>  <span style="color: #009999">58.623963</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">14</span>  <span style="color: #009999">105.709999</span>  <span style="color: #009999">20.005777</span>  <span style="color: #009999">76.259016</span>  <span style="color: #009999">57.730000</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">15</span>  <span style="color: #009999">107.110001</span>  <span style="color: #009999">20.085481</span>  <span style="color: #009999">75.861573</span>  <span style="color: #009999">58.869999</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">16</span>  <span style="color: #009999">109.989998</span>  <span style="color: #009999">19.676996</span>  <span style="color: #009999">75.513814</span>  <span style="color: #009999">59.650002</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">17</span>  <span style="color: #009999">109.949997</span>  <span style="color: #009999">20.005777</span>  <span style="color: #009999">75.096502</span>  <span style="color: #009999">60.639999</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">18</span>  <span style="color: #009999">110.059998</span>  <span style="color: #009999">19.926072</span>  <span style="color: #009999">74.142645</span>  <span style="color: #009999">60.349998</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">21</span>  <span style="color: #009999">111.730003</span>  <span style="color: #009999">20.254852</span>  <span style="color: #009999">74.500342</span>  <span style="color: #009999">60.860001</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">22</span>  <span style="color: #009999">111.800003</span>  <span style="color: #009999">20.224963</span>  <span style="color: #009999">73.983664</span>  <span style="color: #009999">61.119999</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">23</span>  <span style="color: #009999">111.230003</span>  <span style="color: #009999">20.484002</span>  <span style="color: #009999">74.818295</span>  <span style="color: #009999">60.400002</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">25</span>  <span style="color: #009999">111.790001</span>  <span style="color: #009999">20.782894</span>  <span style="color: #009999">74.957399</span>  <span style="color: #009999">60.529999</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">28</span>  <span style="color: #009999">111.570000</span>  <span style="color: #009999">20.224963</span>  <span style="color: #009999">74.063155</span>  <span style="color: #009999">60.610001</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">29</span>  <span style="color: #009999">111.459999</span>  <span style="color: #009999">20.215001</span>  <span style="color: #009999">74.391045</span>  <span style="color: #009999">61.090000</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">30</span>  <span style="color: #009999">110.519997</span>  <span style="color: #009999">21.120001</span>  <span style="color: #009999">73.228524</span>  <span style="color: #009999">60.259998</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">01</span>  <span style="color: #009999">109.489998</span>  <span style="color: #009999">21.500000</span>  <span style="color: #009999">72.374025</span>  <span style="color: #009999">59.200001</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">02</span>  <span style="color: #009999">109.900002</span>  <span style="color: #009999">21.230000</span>  <span style="color: #009999">71.956714</span>  <span style="color: #009999">59.250000</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">05</span>  <span style="color: #009999">109.110001</span>  <span style="color: #009999">21.840000</span>  <span style="color: #009999">71.897100</span>  <span style="color: #009999">60.220001</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">06</span>  <span style="color: #009999">109.949997</span>  <span style="color: #009999">22.160000</span>  <span style="color: #009999">72.006397</span>  <span style="color: #009999">59.950001</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">07</span>  <span style="color: #009999">111.029999</span>  <span style="color: #009999">22.570000</span>  <span style="color: #009999">72.314411</span>  <span style="color: #009999">61.369999</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">08</span>  <span style="color: #009999">112.120003</span>  <span style="color: #009999">22.950001</span>  <span style="color: #009999">71.559271</span>  <span style="color: #009999">61.009998</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">09</span>  <span style="color: #009999">113.949997</span>  <span style="color: #009999">23.090000</span>  <span style="color: #009999">72.234921</span>  <span style="color: #009999">61.970001</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">12</span>  <span style="color: #009999">113.300003</span>  <span style="color: #009999">22.610001</span>  <span style="color: #009999">73.000000</span>  <span style="color: #009999">62.169998</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">13</span>  <span style="color: #009999">115.190002</span>  <span style="color: #009999">22.610001</span>  <span style="color: #009999">74.839996</span>  <span style="color: #009999">62.980000</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">14</span>  <span style="color: #009999">115.190002</span>  <span style="color: #009999">22.670000</span>  <span style="color: #009999">75.709999</span>  <span style="color: #009999">62.680000</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">15</span>  <span style="color: #009999">115.820000</span>  <span style="color: #009999">23.160000</span>  <span style="color: #009999">75.550003</span>  <span style="color: #009999">62.580002</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">16</span>  <span style="color: #009999">115.970001</span>  <span style="color: #009999">22.660000</span>  <span style="color: #009999">74.099998</span>  <span style="color: #009999">62.299999</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">19</span>  <span style="color: #009999">116.639999</span>  <span style="color: #009999">22.480000</span>  <span style="color: #009999">74.400002</span>  <span style="color: #009999">63.619999</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">20</span>  <span style="color: #009999">116.949997</span>  <span style="color: #009999">22.709999</span>  <span style="color: #009999">74.050003</span>  <span style="color: #009999">63.540001</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">21</span>  <span style="color: #009999">117.059998</span>  <span style="color: #009999">22.629999</span>  <span style="color: #009999">73.959999</span>  <span style="color: #009999">63.540001</span>

[<span style="color: #009999">750</span> rows x <span style="color: #009999">4</span> columns]
</pre></div>
	<p>Above, we see that we have a dataframe that holds the price of each stock indexed by the data. This is a great structure to hold our data as we can easily perform computation on each column individually and modify the rows of the dataframe. The pandas package was created by Wes McKinney at AQR Capital. A majority of financial institutions who use python use this package. You can find out more information about pandas with their 10 minute introduction <a href='http://pandas.pydata.org/pandas-docs/stable/10min.html'>here</a>.</p>

	<p>Let us now create a function to plot each of the individual stocks. We will call this function plot_stocks. This function will take in a dataframe of stocks, which we call stocks, and a parameter called show, which is initially set to no. If we decide to set show to yes then we will display the plot of the individual stocks when the python program is run. We will use a plot style called ggplot. To plot our dataframe we simply just call stocks.plot(). We can then set a title, y label, and an x label. We can move the legend outside the plot so that it is not in the way of the trend lines and pad it so that the plot is tighter. We can then check if the parameter show is yes and if so we can display the plot when the function is called. If not, we do not show the plot. We end the function by saving the stock performance plot to a png called stock_performance.png. Our function looks as follows:</p>
	<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">def</span> <span style="color: #00aa00">plot_stocks</span>(stocks,show=<span style="color: #aa5500">&#39;no&#39;</span>):
    plt.style.use(<span style="color: #aa5500">&#39;ggplot&#39;</span>)
    stocks.plot()
    plt.title(<span style="color: #aa5500">&#39;Stock Performance&#39;</span>)
    plt.ylabel(<span style="color: #aa5500">&#39;Stock Price&#39;</span>)
    plt.xlabel(<span style="color: #aa5500">&#39;Date&#39;</span>)
    plt.legend(loc=<span style="color: #aa5500">&#39;upper left&#39;</span>, prop={<span style="color: #aa5500">&#39;size&#39;</span>:<span style="color: #009999">6</span>}, bbox_to_anchor=(<span style="color: #009999">1</span>,<span style="color: #009999">1</span>))
    plt.tight_layout(pad=<span style="color: #009999">7</span>)
    <span style="color: #0000aa">if</span> show == <span style="color: #aa5500">&#39;yes&#39;</span>:
        plt.show()
    plt.savefig(<span style="color: #aa5500">&#39;stock_performance.png&#39;</span>)
    <span style="color: #0000aa">return</span>
</pre></div>



	<p>Our python program so far looks as follows:</p>
	<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">pd</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas_datareader.data</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">web</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">plt</span>

<span style="color: #0000aa">def</span> <span style="color: #00aa00">get_adjusted_close</span>(tickers,start,end):
    d = {} 
    <span style="color: #0000aa">for</span> ticker <span style="color: #0000aa">in</span> tickers:
        d[ticker] = web.DataReader(ticker,<span style="color: #aa5500">&quot;yahoo&quot;</span>,start,end) 
    pan = pd.Panel(d)
    df_adj_close = pan.minor_xs(<span style="color: #aa5500">&#39;Adj Close&#39;</span>)
    <span style="color: #0000aa">return</span> df_adj_close

<span style="color: #0000aa">def</span> <span style="color: #00aa00">plot_stocks</span>(stocks,show=<span style="color: #aa5500">&#39;no&#39;</span>):
    plt.style.use(<span style="color: #aa5500">&#39;ggplot&#39;</span>)
    stocks.plot()
    plt.title(<span style="color: #aa5500">&#39;Stock Performance&#39;</span>)
    plt.ylabel(<span style="color: #aa5500">&#39;Stock Price&#39;</span>)
    plt.xlabel(<span style="color: #aa5500">&#39;Date&#39;</span>)
    plt.legend(loc=<span style="color: #aa5500">&#39;upper left&#39;</span>, prop={<span style="color: #aa5500">&#39;size&#39;</span>:<span style="color: #009999">6</span>}, bbox_to_anchor=(<span style="color: #009999">1</span>,<span style="color: #009999">1</span>))
    plt.tight_layout(pad=<span style="color: #009999">7</span>)
    <span style="color: #0000aa">if</span> show == <span style="color: #aa5500">&#39;yes&#39;</span>:
        plt.show()
    plt.savefig(<span style="color: #aa5500">&#39;stock_performance.png&#39;</span>)
    <span style="color: #0000aa">return</span>
</pre></div>



	<p>We can run our plot_stocks function and show the plot by calling as follows in the main method:</p>
	<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">pd</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas_datareader.data</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">web</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">plt</span>

<span style="color: #0000aa">def</span> <span style="color: #00aa00">get_adjusted_close</span>(tickers,start,end):
    d = {} 
    <span style="color: #0000aa">for</span> ticker <span style="color: #0000aa">in</span> tickers:
        d[ticker] = web.DataReader(ticker,<span style="color: #aa5500">&quot;yahoo&quot;</span>,start,end) 
    pan = pd.Panel(d)
    df_adj_close = pan.minor_xs(<span style="color: #aa5500">&#39;Adj Close&#39;</span>)
    <span style="color: #0000aa">return</span> df_adj_close

<span style="color: #0000aa">def</span> <span style="color: #00aa00">plot_stocks</span>(stocks,show=<span style="color: #aa5500">&#39;no&#39;</span>):
    plt.style.use(<span style="color: #aa5500">&#39;ggplot&#39;</span>)
    stocks.plot()
    plt.title(<span style="color: #aa5500">&#39;Stock Performance&#39;</span>)
    plt.ylabel(<span style="color: #aa5500">&#39;Stock Price&#39;</span>)
    plt.xlabel(<span style="color: #aa5500">&#39;Date&#39;</span>)
    plt.legend(loc=<span style="color: #aa5500">&#39;upper left&#39;</span>, prop={<span style="color: #aa5500">&#39;size&#39;</span>:<span style="color: #009999">6</span>}, bbox_to_anchor=(<span style="color: #009999">1</span>,<span style="color: #009999">1</span>))
    plt.tight_layout(pad=<span style="color: #009999">7</span>)
    <span style="color: #0000aa">if</span> show == <span style="color: #aa5500">&#39;yes&#39;</span>:
        plt.show()
    plt.savefig(<span style="color: #aa5500">&#39;stock_performance.png&#39;</span>)
    <span style="color: #0000aa">return</span>

<span style="color: #0000aa">if</span> __name__ == <span style="color: #aa5500">&#39;__main__&#39;</span>:
    tickers = [<span style="color: #aa5500">&#39;AAPL&#39;</span>,<span style="color: #aa5500">&#39;BAC&#39;</span>,<span style="color: #aa5500">&#39;GILD&#39;</span>,<span style="color: #aa5500">&#39;MSFT&#39;</span>]
    start = <span style="color: #aa5500">&#39;2014-01-01&#39;</span>
    end = <span style="color: #aa5500">&#39;2016-12-21&#39;</span>
    df_adj_close = get_adjusted_close(tickers,start,end)
    plot_stocks(df_adj_close,show=<span style="color: #aa5500">&#39;yes&#39;</span>)
</pre></div>



	<p>We will see the following figure pop up:</p>
	<center><img src='images/portfolio_construction/1.png' width='550px'></center>
	<p>Additionally, the figure above will be saved to stock_performance.png. Let us now move forward to creating our portfolio value construction function.</p>

	<p>Let us now create our function that calculates portfolio value. We will construct a function called Portfolio_Value that takes in a dataframe of adjusted close prices, the shares for each stock in the portfolio, and how much money we have initially invested in the portfolio. Our function so far looks as follows:</p> 
  <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">def</span> <span style="color: #00aa00">Portfolio_Value</span>(df_adj_close,shares,cash):
</pre></div>


  <p>We first need to convert the shares into weights. We can create a float variable called total_shares which sums up the total shares we have in our portfolio. We can then create a new list called weights which takes each stock's shares and divivides it by the total_shares variable. Doing so, our program looks as follows:</p>
  <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">def</span> <span style="color: #00aa00">Portfolio_Value</span>(df_adj_close,shares,cash):
    total_shares = <span style="color: #00aaaa">float</span>(<span style="color: #00aaaa">sum</span>(shares))
    weights = [w/total_shares <span style="color: #0000aa">for</span> w <span style="color: #0000aa">in</span> shares]
</pre></div>



	<p>We now need to normalize our adjusted close prices. We can do this by taking each date's price and dividing by the price on the first day. We can store this in a variable called normed. We can then multiply our normed dataframe by the weights and store this in a dataframe called alloced. We can then multiply alloced by our cash variable and can then sum across the column (axis=1) to get our portfolio value in a pandas series. We then return the pandas series. Doing so, our functon looks as follows:</p>
  <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">def</span> <span style="color: #00aa00">Portfolio_Value</span>(df_adj_close,shares,cash):
    total_shares = <span style="color: #00aaaa">float</span>(<span style="color: #00aaaa">sum</span>(shares))
    weights = [w/total_shares <span style="color: #0000aa">for</span> w <span style="color: #0000aa">in</span> shares]
    normed = df_adj_close/df_adj_close.ix[<span style="color: #009999">0</span>,:] 
    alloced = normed*weights
    pos_vals = alloced*cash 
    series_portfolio_value = pos_vals.sum(axis=<span style="color: #009999">1</span>)  
    <span style="color: #0000aa">return</span> series_portfolio_value
</pre></div>

      <p>Our python progam so far looks as follows:</p>
      <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">pd</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas_datareader.data</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">web</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">plt</span>

<span style="color: #0000aa">def</span> <span style="color: #00aa00">get_adjusted_close</span>(tickers,start,end):
    d = {} 
    <span style="color: #0000aa">for</span> ticker <span style="color: #0000aa">in</span> tickers:
        d[ticker] = web.DataReader(ticker,<span style="color: #aa5500">&quot;yahoo&quot;</span>,start,end) 
    pan = pd.Panel(d)
    df_adj_close = pan.minor_xs(<span style="color: #aa5500">&#39;Adj Close&#39;</span>)
    <span style="color: #0000aa">return</span> df_adj_close

<span style="color: #0000aa">def</span> <span style="color: #00aa00">Portfolio_Value</span>(df_adj_close,shares,cash):
    total_shares = <span style="color: #00aaaa">float</span>(<span style="color: #00aaaa">sum</span>(shares))
    weights = [w/total_shares <span style="color: #0000aa">for</span> w <span style="color: #0000aa">in</span> shares]
    normed = df_adj_close/df_adj_close.ix[<span style="color: #009999">0</span>,:] 
    alloced = normed*weights
    pos_vals = alloced*cash 
    series_portfolio_value = pos_vals.sum(axis=<span style="color: #009999">1</span>)  
    <span style="color: #0000aa">return</span> series_portfolio_value


<span style="color: #0000aa">def</span> <span style="color: #00aa00">plot_stocks</span>(stocks,show=<span style="color: #aa5500">&#39;no&#39;</span>):
    plt.style.use(<span style="color: #aa5500">&#39;ggplot&#39;</span>)
    stocks.plot()
    plt.title(<span style="color: #aa5500">&#39;Stock Performance&#39;</span>)
    plt.ylabel(<span style="color: #aa5500">&#39;Stock Price&#39;</span>)
    plt.xlabel(<span style="color: #aa5500">&#39;Date&#39;</span>)
    plt.legend(loc=<span style="color: #aa5500">&#39;upper left&#39;</span>, prop={<span style="color: #aa5500">&#39;size&#39;</span>:<span style="color: #009999">6</span>}, bbox_to_anchor=(<span style="color: #009999">1</span>,<span style="color: #009999">1</span>))
    plt.tight_layout(pad=<span style="color: #009999">7</span>)
    <span style="color: #0000aa">if</span> show == <span style="color: #aa5500">&#39;yes&#39;</span>:
        plt.show()
    plt.savefig(<span style="color: #aa5500">&#39;stock_performance.png&#39;</span>)
    <span style="color: #0000aa">return</span>

<span style="color: #0000aa">if</span> __name__ == <span style="color: #aa5500">&#39;__main__&#39;</span>:
    tickers = [<span style="color: #aa5500">&#39;AAPL&#39;</span>,<span style="color: #aa5500">&#39;BAC&#39;</span>,<span style="color: #aa5500">&#39;GILD&#39;</span>,<span style="color: #aa5500">&#39;MSFT&#39;</span>]
    start = <span style="color: #aa5500">&#39;2014-01-01&#39;</span>
    end = <span style="color: #aa5500">&#39;2016-12-21&#39;</span>
    df_adj_close = get_adjusted_close(tickers,start,end)
    plot_stocks(df_adj_close,show=<span style="color: #aa5500">&#39;no&#39;</span>)
    shares = [<span style="color: #009999">100</span>,<span style="color: #009999">100</span>,<span style="color: #009999">100</span>,<span style="color: #009999">100</span>]
    cash = <span style="color: #009999">100000</span>
    port_val = Portfolio_Value(df_adj_close,shares,cash)
    <span style="color: #0000aa">print</span> port_val
</pre></div>

      <p>Our portfolio value output is as follows:</p>
      <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">Date
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">02</span>    <span style="color: #009999">100000.000000</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">03</span>     <span style="color: #009999">99468.189416</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">06</span>     <span style="color: #009999">99105.967148</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">07</span>     <span style="color: #009999">98717.172107</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">08</span>     <span style="color: #009999">98784.704353</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">09</span>     <span style="color: #009999">98983.716968</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">10</span>     <span style="color: #009999">99261.324736</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">13</span>     <span style="color: #009999">97571.284761</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">14</span>     <span style="color: #009999">99734.196045</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">15</span>    <span style="color: #009999">101559.159083</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">16</span>    <span style="color: #009999">102284.876150</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">17</span>    <span style="color: #009999">101385.491818</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">21</span>    <span style="color: #009999">102680.906042</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">22</span>    <span style="color: #009999">103046.556053</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">23</span>    <span style="color: #009999">102884.808450</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">24</span>    <span style="color: #009999">101787.219336</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">27</span>    <span style="color: #009999">100660.261690</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">28</span>    <span style="color: #009999">100086.863827</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">29</span>     <span style="color: #009999">99739.149762</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">30</span>    <span style="color: #009999">100773.170862</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">01</span>-<span style="color: #009999">31</span>    <span style="color: #009999">100900.851985</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">03</span>     <span style="color: #009999">98801.832309</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">04</span>    <span style="color: #009999">100102.869102</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">05</span>     <span style="color: #009999">98709.294549</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">06</span>     <span style="color: #009999">98988.377427</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">07</span>    <span style="color: #009999">100519.801481</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">10</span>    <span style="color: #009999">101690.547705</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">11</span>    <span style="color: #009999">102777.399594</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">12</span>    <span style="color: #009999">102842.030018</span>
<span style="color: #009999">2014</span>-<span style="color: #009999">02</span>-<span style="color: #009999">13</span>    <span style="color: #009999">103505.970935</span>
                  ...      
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">09</span>    <span style="color: #009999">136459.182772</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">10</span>    <span style="color: #009999">135406.415838</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">11</span>    <span style="color: #009999">135784.190703</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">14</span>    <span style="color: #009999">136029.519845</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">15</span>    <span style="color: #009999">137322.711786</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">16</span>    <span style="color: #009999">138082.460598</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">17</span>    <span style="color: #009999">139176.267046</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">18</span>    <span style="color: #009999">138545.226192</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">21</span>    <span style="color: #009999">140129.911925</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">22</span>    <span style="color: #009999">140117.211793</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">23</span>    <span style="color: #009999">140104.310116</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">25</span>    <span style="color: #009999">140915.698852</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">28</span>    <span style="color: #009999">139695.283983</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">29</span>    <span style="color: #009999">140105.318106</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">11</span>-<span style="color: #009999">30</span>    <span style="color: #009999">140239.264653</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">01</span>    <span style="color: #009999">139437.029854</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">02</span>    <span style="color: #009999">139033.436754</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">05</span>    <span style="color: #009999">140436.058260</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">06</span>    <span style="color: #009999">141073.375110</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">07</span>    <span style="color: #009999">143237.237150</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">08</span>    <span style="color: #009999">143691.848699</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">09</span>    <span style="color: #009999">145464.407324</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">12</span>    <span style="color: #009999">144883.480928</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">13</span>    <span style="color: #009999">146742.365014</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">14</span>    <span style="color: #009999">146919.406566</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">15</span>    <span style="color: #009999">147790.885967</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">16</span>    <span style="color: #009999">146334.003943</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">19</span>    <span style="color: #009999">147335.761926</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">20</span>    <span style="color: #009999">147630.896156</span>
<span style="color: #009999">2016</span>-<span style="color: #009999">12</span>-<span style="color: #009999">21</span>    <span style="color: #009999">147508.228333</span>
dtype: float64
</pre></div>

      <p>Let us now create a function to plot and save our portfolio value. We will create a function called Plot_Portfolio_Value that takes in the portfolio value series (port_val) and a parameter called show. We will initially set show to no, but if it is yes then we will show the portfolio value plot when we call the function. We will use the ggplot style for our plot and create a variable called fid. We can create a subplot in this fig and add our title and ylabel. We do not need to add an xlabel since our pandas series will automatically make the x axis label display Date. We can then simply call port_val.plot(). We then check if show equals yes. If it does we display the plot. If show equals no then we do not display the plot. We then save the figure to Portfolio_Value.png. Our function is as follows:</p>

      <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">def</span> <span style="color: #00aa00">Plot_Portfolio_Value</span>(port_val,show=<span style="color: #aa5500">&#39;no&#39;</span>):
    plt.style.use(<span style="color: #aa5500">&#39;ggplot&#39;</span>)
    fig = plt.figure()
    ax = fig.add_subplot(<span style="color: #009999">111</span>)
    ax.set_title(<span style="color: #aa5500">&#39;Portfolio Value&#39;</span>)
    ax.set_ylabel(<span style="color: #aa5500">&#39;Portfolio Value ($)&#39;</span>)
    port_val.plot()
    <span style="color: #0000aa">if</span> show == <span style="color: #aa5500">&#39;yes&#39;</span>:
        plt.show()
    plt.savefig(<span style="color: #aa5500">&#39;Portfolio_Value.png&#39;</span>)
    <span style="color: #0000aa">return</span> port_val
</pre></div>

      <p>Our python function now looks as follows:</p>
      <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">pd</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">pandas_datareader.data</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">web</span>
<span style="color: #0000aa">import</span> <span style="color: #00aaaa; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #0000aa">as</span> <span style="color: #00aaaa; text-decoration: underline">plt</span>

<span style="color: #0000aa">def</span> <span style="color: #00aa00">get_adjusted_close</span>(tickers,start,end):
    d = {} 
    <span style="color: #0000aa">for</span> ticker <span style="color: #0000aa">in</span> tickers:
        d[ticker] = web.DataReader(ticker,<span style="color: #aa5500">&quot;yahoo&quot;</span>,start,end) 
    pan = pd.Panel(d)
    df_adj_close = pan.minor_xs(<span style="color: #aa5500">&#39;Adj Close&#39;</span>)
    <span style="color: #0000aa">return</span> df_adj_close

<span style="color: #0000aa">def</span> <span style="color: #00aa00">Portfolio_Value</span>(df_adj_close,shares,cash):
    total_shares = <span style="color: #00aaaa">float</span>(<span style="color: #00aaaa">sum</span>(shares))
    weights = [w/total_shares <span style="color: #0000aa">for</span> w <span style="color: #0000aa">in</span> shares]
    normed = df_adj_close/df_adj_close.ix[<span style="color: #009999">0</span>,:] 
    alloced = normed*weights
    pos_vals = alloced*cash 
    series_portfolio_value = pos_vals.sum(axis=<span style="color: #009999">1</span>)  
    <span style="color: #0000aa">return</span> series_portfolio_value

<span style="color: #0000aa">def</span> <span style="color: #00aa00">Plot_Portfolio_Value</span>(port_val,show=<span style="color: #aa5500">&#39;no&#39;</span>):
    plt.style.use(<span style="color: #aa5500">&#39;ggplot&#39;</span>)
    fig = plt.figure()
    ax = fig.add_subplot(<span style="color: #009999">111</span>)
    ax.set_title(<span style="color: #aa5500">&#39;Portfolio Value&#39;</span>)
    ax.set_ylabel(<span style="color: #aa5500">&#39;Portfolio Value ($)&#39;</span>)
    port_val.plot()
    <span style="color: #0000aa">if</span> show == <span style="color: #aa5500">&#39;yes&#39;</span>:
        plt.show()
    plt.savefig(<span style="color: #aa5500">&#39;Portfolio_Value.png&#39;</span>)
    <span style="color: #0000aa">return</span> 

<span style="color: #0000aa">def</span> <span style="color: #00aa00">plot_stocks</span>(stocks,show=<span style="color: #aa5500">&#39;no&#39;</span>):
    plt.style.use(<span style="color: #aa5500">&#39;ggplot&#39;</span>)
    stocks.plot()
    plt.title(<span style="color: #aa5500">&#39;Stock Performance&#39;</span>)
    plt.ylabel(<span style="color: #aa5500">&#39;Stock Price&#39;</span>)
    plt.xlabel(<span style="color: #aa5500">&#39;Date&#39;</span>)
    plt.legend(loc=<span style="color: #aa5500">&#39;upper left&#39;</span>, prop={<span style="color: #aa5500">&#39;size&#39;</span>:<span style="color: #009999">6</span>}, bbox_to_anchor=(<span style="color: #009999">1</span>,<span style="color: #009999">1</span>))
    plt.tight_layout(pad=<span style="color: #009999">7</span>)
    <span style="color: #0000aa">if</span> show == <span style="color: #aa5500">&#39;yes&#39;</span>:
        plt.show()
    plt.savefig(<span style="color: #aa5500">&#39;stock_performance.png&#39;</span>)
    <span style="color: #0000aa">return</span>

<span style="color: #0000aa">if</span> __name__ == <span style="color: #aa5500">&#39;__main__&#39;</span>:
    tickers = [<span style="color: #aa5500">&#39;AAPL&#39;</span>,<span style="color: #aa5500">&#39;BAC&#39;</span>,<span style="color: #aa5500">&#39;GILD&#39;</span>,<span style="color: #aa5500">&#39;MSFT&#39;</span>]
    start = <span style="color: #aa5500">&#39;2014-01-01&#39;</span>
    end = <span style="color: #aa5500">&#39;2016-12-21&#39;</span>
    df_adj_close = get_adjusted_close(tickers,start,end)
    plot_stocks(df_adj_close,show=<span style="color: #aa5500">&#39;no&#39;</span>)
    shares = [<span style="color: #009999">100</span>,<span style="color: #009999">100</span>,<span style="color: #009999">100</span>,<span style="color: #009999">100</span>]
    cash = <span style="color: #009999">100000</span>
    port_val = Portfolio_Value(df_adj_close,shares,cash)
    Plot_Portfolio_Value(port_val,show=<span style="color: #aa5500">&#39;yes&#39;</span>)
</pre></div>

      <p>We set the show parameter to yes above and our portfolio value plot is as follows:</p>
      <center><img src='images/portfolio_construction/2.png' width='550px'></center>
      <p>This plot is also saved to Portfolio_Value.png.</p>
      <p>We now have code to create a portfolio and generate plots for it. This is an incremental part in building a backtester, which is soon to come!</p>
      <p>The above code (Portfolio_Constructor.py) can be downloaded from <a href='https://github.com/ad1m/derivative_code'>here</a>.</p>


        <!--<p>With the above function we have an automated way of pulling stock data. All we need to do is place the tickers as strings into the tickers list and provide a start date, end date, and optional all_data parameter and we have stock data within seconds!</p>
        <p>The above code (data_scraper.py) can be downloaded from <a href='https://github.com/ad1m/derivative_code'>here</a>.</p> -->


        







              
    </div>

  </main>
  </body>